{{ 'scrolling-testimonials.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign background_color = section.settings.background_color
  assign text_color = section.settings.text_color
  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed | times: 1000
  assign button_text = section.settings.button_text
  assign button_link = section.settings.button_link
-%}

<div class="scrolling-testimonials" style="background-color: {{ background_color }}; color: {{ text_color }};">
  <div class="scrolling-testimonials__inner">
    <div class="scrolling-testimonials__header">
      {% if heading != blank %}
        <h2 class="scrolling-testimonials__heading">{{ heading }}</h2>
      {% endif %}
      {% if subheading != blank %}
        <div class="scrolling-testimonials__subheading">{{ subheading }}</div>
      {% endif %}
    </div>

    <div class="scrolling-testimonials__slider-container">
      <button type="button" class="scrolling-testimonials__nav scrolling-testimonials__nav--prev" aria-label="上一个">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <div class="scrolling-testimonials__slider">
        {% for block in section.blocks %}
          {%- liquid
            assign image = block.settings.image
            assign heading = block.settings.heading
            assign text = block.settings.text
          -%}
          <div class="scrolling-testimonials__slide" {{ block.shopify_attributes }}>
            <div class="scrolling-testimonials__slide-inner">
              {% if image != blank %}
                <div class="scrolling-testimonials__image-container">
                  {% render 'responsive-image', image: image, sizes: '600x' %}
                </div>
              {% endif %}
              
              <div class="scrolling-testimonials__content">
                {% if heading != blank %}
                  <h3 class="scrolling-testimonials__slide-heading">{{ heading }}</h3>
                {% endif %}
                {% if text != blank %}
                  <div class="scrolling-testimonials__text">{{ text }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      
      <button type="button" class="scrolling-testimonials__nav scrolling-testimonials__nav--next" aria-label="下一个">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="scrolling-testimonials__footer">
      {% if section.settings.footer_text != blank %}
        <div class="scrolling-testimonials__footer-text">{{ section.settings.footer_text }}</div>
      {% endif %}
      
      {% if section.settings.button_text != blank %}
        <div class="scrolling-testimonials__button-container">
          <a href="{{ section.settings.button_link }}" class="scrolling-testimonials__button">
            {{ section.settings.button_text }}
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 获取所有需要的元素
  const sliderContainer = document.querySelector('.scrolling-testimonials__slider-container');
  const slider = document.querySelector('.scrolling-testimonials__slider');
  const slides = document.querySelectorAll('.scrolling-testimonials__slide');
  const prevBtn = document.querySelector('.scrolling-testimonials__nav--prev');
  const nextBtn = document.querySelector('.scrolling-testimonials__nav--next');
  
  // 如果没有足够的幻灯片，隐藏导航按钮
  if (!slider || slides.length <= 1) {
    if (prevBtn) prevBtn.style.display = 'none';
    if (nextBtn) nextBtn.style.display = 'none';
    return;
  }
  
  // 设置变量
  let currentIndex = 0;
  let autoplayInterval;
  const autoplayDelay = {{ autoplay_speed }};
  const shouldAutoplay = {{ autoplay | json }};
  
  // 更新滑块位置的函数
  function updateSliderPosition() {
    if (!slider || !slides.length) return;
    
    const slideWidth = slides[0].offsetWidth;
    slider.style.transform = `translateX(-${currentIndex * slideWidth}px)`;
  }
  
  // 切换到指定幻灯片
  function goToSlide(index) {
    if (index < 0) {
      currentIndex = slides.length - 1;
    } else if (index >= slides.length) {
      currentIndex = 0;
    } else {
      currentIndex = index;
    }
    
    updateSliderPosition();
  }
  
  // 自动播放功能
  function startAutoplay() {
    if (autoplayInterval) clearInterval(autoplayInterval);
    
    if (slides.length <= 1) return;
    
    autoplayInterval = setInterval(function() {
      goToSlide(currentIndex + 1);
    }, autoplayDelay);
  }
  
  function stopAutoplay() {
    if (autoplayInterval) {
      clearInterval(autoplayInterval);
      autoplayInterval = null;
    }
  }
  
  // 添加按钮点击事件
  if (prevBtn) {
    prevBtn.addEventListener('click', function() {
      goToSlide(currentIndex - 1);
      stopAutoplay();
    });
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', function() {
      goToSlide(currentIndex + 1);
      stopAutoplay();
    });
  }
  
  // 监听窗口大小变化
  window.addEventListener('resize', updateSliderPosition);
  
  // 鼠标悬停时暂停自动播放
  if (sliderContainer) {
    sliderContainer.addEventListener('mouseenter', stopAutoplay);
    sliderContainer.addEventListener('mouseleave', function() {
      if (shouldAutoplay) {
        startAutoplay();
      }
    });
  }
  
  // 初始化
  updateSliderPosition();
  
  // 如果需要自动播放，启动它
  if (shouldAutoplay) {
    startAutoplay();
  }
});
</script>

{% schema %}
{
  "name": "滚动展示",
  "class": "section-scrolling-testimonials",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "标题",
      "default": "In addition to whatever you may be currently experiencing, have you ever encountered any of the following challenges?"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "副标题",
      "default": "<p>在这里添加您的副标题文本</p>"
    },
    {
      "type": "richtext",
      "id": "footer_text",
      "label": "底部文本",
      "default": "<p>Life can be challenging, and we all face obstacles that can cause stress and anxiety. Whether you're a teacher struggling to engage students, a salesperson feeling pressure to meet targets, or an entrepreneur seeking growth for your business, we understand the unique challenges you face.</p>"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "文字颜色",
      "default": "#333333"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "自动播放",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "自动播放速度（秒）",
      "min": 3,
      "max": 10,
      "step": 1,
      "default": 5
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "按钮文字",
      "default": "了解更多"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "按钮链接"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "滑块",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "图片"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "标题",
          "default": "Couple & Relationship Issues"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "文本内容",
          "default": "<p>Gain clarity on compatibility with your partner's personality traits, communication styles, and emotional needs.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "滚动展示",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %} 